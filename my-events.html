<!DOCTYPE html>
<html lang="en">

<head>
    <title>Family Weather Events - My Events</title>
    <link rel="icon" href="images/icon.webp" type="image/gif" sizes="16x16">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport" >
    <meta content="FamilyWeather" name="description" >
    <meta content="" name="keywords" >
    <meta content="" name="author" >
    <!-- CSS Files
    ================================================== -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bootstrap">
    <link href="css/vendors.css" rel="stylesheet" type="text/css" >
    <link href="css/style.css" rel="stylesheet" type="text/css" >
    <!-- color scheme -->
    <link id="colors" href="css/colors/scheme-01.css" rel="stylesheet" type="text/css" >

</head>

<body class="dark-scheme">

    <div id="wrapper">

        <div class="float-text show-on-scroll">
            <span><a href="#">Scroll to top</a></span>
        </div>
        <div class="scrollbar-v show-on-scroll"></div>

        <!-- page preloader begin -->
        <div id="de-loader"></div>
        
        <div class="fw-brand-banner">
            <div class="container text-center text-lg-start">
                <a class="fw-brand-link" href="index.html">
                    <img src="images/assets/Family%20Weather%20Logo.png%233.png" alt="Family Weather Events" >
                </a>
            </div>
        </div>

        <header class="transparent">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="de-flex">
                            <div class="de-flex-col">
                                <div class="de-flex-col header-col-mid">
                                    <ul id="mainmenu">
                                        <li><a class="menu-item" href="index.html"><i class="fa fa-house me-2"></i>Home</a></li>
                                        <li><a class="menu-item" href="create-event.html"><i class="fa fa-plus me-2"></i>Create Event</a></li>
                                        <li><a class="menu-item active" href="my-events.html"><i class="fa fa-calendar me-2"></i>My Events</a></li>
                                        <li><a class="menu-item" href="/feeds.html"><i class="fa fa-comments me-2"></i>Feeds</a></li>
                                        <li><a class="menu-item" href="invite.html"><i class="fa fa-envelope me-2"></i>Invite</a></li>
                                        <li><a class="menu-item" href="rsvp.html"><i class="fa fa-check me-2"></i>RSVP</a></li>
                                        <li><a class="menu-item" href="settings.html"><i class="fa fa-gear me-2"></i>Settings</a></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="de-flex-col nav-actions">
                                <a class="btn-main fx-slide nav-cta" href="create-event.html"><span><i class="fa fa-plus me-2"></i>Create Event</span></a>

                                <div class="menu_side_area">
                                    <span id="menu-btn"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section id="section-hero" class="section-dark no-top no-bottom text-light jarallax relative mh-800" data-video-src="mp4:video/1.mp4">
            <div class="gradient-edge-top op-6 h-50 color"></div>
            <div class="gradient-edge-bottom"></div>
            <div class="sw-overlay op-8"></div>
            <div class="abs abs-centered z-2 w-80">
                <div class="container wow scaleIn" data-wow-duration="3s">
                    <div class="row">
                        <div class="col-lg-12 text-center">
                            <img src="images/fw-icons/cloudy.svg" class="w-80px mb-3" alt="">
                            <div class="subtitle">Family Weather Events</div>
                            <h1 class="fs-120 text-uppercase fs-sm-12vw mb-4 lh-1">My Events</h1>
                            <p class="lead">Manage upcoming, draft, and past events in one place.</p>

                            <div class="spacer-single"></div>

                            <a class="btn-main mx-2 fx-slide" href="create-event.html"><span><i class="fa fa-plus me-2"></i>Create Event</span></a>
                            <a class="btn-main btn-line mx-2 fx-slide" href="index.html"><span><i class="fa fa-house me-2"></i>Back to Home</span></a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="section-events" class="bg-dark section-dark text-light">
            <div class="container">
                <div class="row g-4" id="events-grid"></div>
            </div>
        </section>

    </div>

    <!-- footer begin -->
    <footer class="text-light section-dark">
        <div class="container">
            <div class="row g-4 align-items-center">
                <div class="col-md-12">
                    <div class="d-lg-flex align-items-center justify-content-between text-center">
                        <div>
                            <h3 class="fs-20">Family Weather Events</h3>
                            Plan together with the people you care about.
                        </div>
                        <div>
                            <img src="images/assets/Family%20Weather%20Logo.png%233.png" class="w-150px" alt=""><br>
                            <div class="social-icons mb-sm-30 mt-4">
                                <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                                <a href="#"><i class="fa-brands fa-instagram"></i></a>
                                <a href="#"><i class="fa-brands fa-twitter"></i></a>
                                <a href="#"><i class="fa-brands fa-youtube"></i></a>
                            </div>

                        </div>
                        <div>
                            <h3 class="fs-20">Contact Us</h3>
                            T. +1 123 456 789<br>
                            M. contact@familyweather.com
                        </div>
                    </div>
                </div>                    
            </div>
        </div>
        <div class="subfooter">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 text-center">
                        Copyright 2026 - Family Weather Events
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- footer end -->
    
    <!-- Javascript Files
    ================================================== -->
    <script src="js/vendors.js"></script>
    <script src="js/fw-settings.js"></script>
<script src="js/designesia.js"></script>
    <script src="js/countdown-custom.js"></script>
    <script src="js/custom-marquee.js"></script>
    <script type="module" src="js/authNav.js"></script>
    <script type="module" src="js/authGate.js"></script>
            <script>
        (function () {
            const STORAGE_KEYS = {
                ownerEmail: "fw_owner_email",
                events: "fw_events",
                invites: "fw_invites",
                rsvps: "fw_rsvps"
            };

            function getCurrentUserEmail() {
                let email = localStorage.getItem(STORAGE_KEYS.ownerEmail);
                if (!email) {
                    email = window.prompt("Enter your email to personalize events:") || "";
                    email = email.trim();
                    if (email) {
                        localStorage.setItem(STORAGE_KEYS.ownerEmail, email);
                    }
                }
                return email || "";
            }

            const CURRENT_USER_EMAIL = "maynex1x@gmail.com";

            const seedEvents = [
                { id: "evt_001", title: "Neighborhood Cleanup", date: "Sat, Mar 21", time: "10:00 AM", visibility: "Public", owner_email: "maynex1x@gmail.com" },
                { id: "evt_002", title: "Family Potluck", date: "Sun, Apr 05", time: "2:00 PM", visibility: "Private", owner_email: "maynex1x@gmail.com" },
                { id: "evt_003", title: "Soccer Season Kickoff", date: "Wed, Apr 22", time: "6:00 PM", visibility: "RSVP Open", owner_email: "maynex1x@gmail.com" },
                { id: "evt_004", title: "Community Garden Build", date: "Fri, May 08", time: "9:00 AM", visibility: "Draft", owner_email: "alex@example.com" },
                { id: "evt_005", title: "Volunteer Appreciation", date: "Thu, Jun 11", time: "7:00 PM", visibility: "Private", owner_email: "alex@example.com" },
                { id: "evt_006", title: "School Fundraiser", date: "Tue, Jul 14", time: "5:30 PM", visibility: "Public", owner_email: "jordan@example.com" }
            ];

            function readStorage(key, fallback) {
                try {
                    const raw = localStorage.getItem(key);
                    return raw ? JSON.parse(raw) : fallback;
                } catch (err) {
                    return fallback;
                }
            }

            function writeStorage(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }

            function ensureSeedData() {
                const existingEvents = readStorage(STORAGE_KEYS.events, null);
                if (!existingEvents || !existingEvents.length) {
                    writeStorage(STORAGE_KEYS.events, seedEvents);
                }
                const existingInvites = readStorage(STORAGE_KEYS.invites, null);
                if (!existingInvites) {
                    writeStorage(STORAGE_KEYS.invites, []);
                }
                const existingRsvps = readStorage(STORAGE_KEYS.rsvps, null);
                if (!existingRsvps) {
                    writeStorage(STORAGE_KEYS.rsvps, []);
                }
            }

            function generateToken() {
                return Math.random().toString(36).slice(2, 12);
            }

            function getOrCreateInviteToken(eventId, invitee) {
                const invites = readStorage(STORAGE_KEYS.invites, []);
                const existing = invites.find((inv) => inv.event_id === eventId && inv.invitee === invitee);
                if (existing) {
                    return existing.token;
                }
                const token = generateToken();
                invites.push({ token, event_id: eventId, invitee });
                writeStorage(STORAGE_KEYS.invites, invites);
                return token;
            }

            function createInvites(eventId, invitees) {
                const tokens = [];
                invitees.forEach((invitee) => {
                    const token = getOrCreateInviteToken(eventId, invitee);
                    tokens.push({ invitee, token });
                });
                return tokens;
            }

            function getRsvpCounts(eventId) {
                const rsvps = readStorage(STORAGE_KEYS.rsvps, []);
                const counts = { Going: 0, Maybe: 0, No: 0 };
                rsvps.filter((r) => r.event_id === eventId).forEach((r) => {
                    if (r.status === "Going") counts.Going += 1;
                    if (r.status === "Maybe") counts.Maybe += 1;
                    if (r.status === "No") counts.No += 1;
                });
                return counts;
            }

            function getRsvpsForEvent(eventId) {
                const rsvps = readStorage(STORAGE_KEYS.rsvps, []);
                return rsvps.filter((r) => r.event_id === eventId);
            }

            
            function buildOwnerGuestStatus(eventId) {
                const invites = readStorage(STORAGE_KEYS.invites, []);
                const rsvps = readStorage(STORAGE_KEYS.rsvps, []);
                const rows = invites.filter((inv) => inv.event_id === eventId).map((inv) => {
                    const match = rsvps.find((r) => r.event_id === eventId && r.invitee === inv.invitee);
                    const status = match ? match.status : "Pending";
                    return `<div class="small">${inv.invitee} � ${status}</div>`;
                });
                if (!rows.length) {
                    return "";
                }
                return `<div class="mt-2">${rows.join("")}</div>`;
            }

            function formatTimestamp(value) {
                if (!value) return "";
                const date = new Date(value);
                if (Number.isNaN(date.getTime())) return "";
                return date.toLocaleString();
            }

            function renderEvents() {
                const grid = document.getElementById("events-grid");
                if (!grid) return;
                const events = readStorage(STORAGE_KEYS.events, []);

                grid.innerHTML = events.map((event) => {
                    const isOwner = event.owner_email === CURRENT_USER_EMAIL;
                    const counts = getRsvpCounts(event.id);
                    const meta = `${event.date} � ${event.time} � ${event.visibility}`;
                    let actions = "";
                    let rsvpPanel = "";
                    let guestStatusHtml = "";

                    if (isOwner) {
                        guestStatusHtml = buildOwnerGuestStatus(event.id);
                        const token = getOrCreateInviteToken(event.id, CURRENT_USER_EMAIL);
                        actions = `
                            <a class="btn-main btn-line disabled" href="#" aria-disabled="true">Edit</a>
                            <a class="btn-main btn-line disabled" href="#" aria-disabled="true">Delete</a>
                            <a class="btn-main btn-line" href="#" data-invite="${event.id}">Invite</a>
                            <a class="btn-main btn-line" href="#" data-copy-link="rsvp.html?token=${token}">Copy RSVP link</a>
                            <a class="btn-main btn-line" href="#" data-toggle-rsvps="${event.id}">View RSVPs</a>
                        `;

                        const entries = getRsvpsForEvent(event.id);
                        if (entries.length) {
                            const rows = entries.map((entry) => {
                                const note = entry.note ? entry.note : "";
                                const stamp = formatTimestamp(entry.created_at);
                                return `
                                    <div class="border-white-bottom-op-2 pb-2 mb-2">
                                        <div class="fw-bold">${entry.invitee}</div>
                                        <div class="small">Status: ${entry.status}${stamp ? ` � ${stamp}` : ""}</div>
                                        ${note ? `<div class=\"small\">Notes: ${note}</div>` : ""}
                                    </div>
                                `;
                            }).join("");
                            rsvpPanel = `
                                <div class="bg-dark-2 rounded-1 p-20 mt-3" data-rsvps-panel="${event.id}" style="display:none;">
                                    ${rows}
                                </div>
                            `;
                        } else {
                            rsvpPanel = `
                                <div class="bg-dark-2 rounded-1 p-20 mt-3" data-rsvps-panel="${event.id}" style="display:none;">
                                    <div class="small">No RSVPs yet.</div>
                                </div>
                            `;
                        }
                    } else {
                        const token = getOrCreateInviteToken(event.id, CURRENT_USER_EMAIL);
                        actions = `
                            <a class="btn-main btn-line" href="rsvp.html?token=${token}">RSVP</a>
                            <a class="btn-main btn-line" href="#" data-copy-link="rsvp.html?token=${token}">Copy RSVP link</a>
                        `;
                    }

                    return `
                        <div class="col-lg-4 col-md-6">
                            <div class="bg-dark-2 rounded-1 p-30 h-100">
                                <h4>${event.title}</h4>
                                <p class="mb-2">${meta}</p>
                                <p class="mb-3">Going: ${counts.Going} � Maybe: ${counts.Maybe} � No: ${counts.No}</p>
                                <div class="d-flex flex-wrap gap-2">
                                    ${actions}
                                </div>
                                ${guestStatusHtml}
                                ${rsvpPanel}
                                
                                
                                
                                
                            </div>
                        </div>
                    `;
                }).join("");
            }

            function bindCopyLinks() {
                document.addEventListener("click", (event) => {
                    const target = event.target.closest("[data-copy-link]");
                    if (!target) return;
                    event.preventDefault();
                    const link = target.getAttribute("data-copy-link");
                    if (!link) return;
                    const full = new URL(link, window.location.href).toString();
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(full).then(() => {
                            target.textContent = "Copied!";
                            setTimeout(() => (target.textContent = "Copy RSVP link"), 1500);
                        });
                    } else {
                        window.prompt("Copy RSVP link:", full);
                    }
                });
            }

            function bindInviteButtons() {
                document.addEventListener("click", (event) => {
                    const target = event.target.closest("[data-invite]");
                    if (!target) return;
                    event.preventDefault();
                    const eventId = target.getAttribute("data-invite");
                    if (!eventId) return;
                    const input = window.prompt("Enter guest emails (comma-separated):");
                    if (!input) return;
                    const invitees = input.split(",").map((value) => value.trim()).filter(Boolean);
                    if (!invitees.length) return;
                    const tokens = createInvites(eventId, invitees);
                    showInviteBanner(tokens.length);
                    const links = tokens.map((item) => {
                        const url = new URL(`rsvp.html?token=${item.token}`, window.location.href).toString();
                        return `${item.invitee}: ${url}`;
                    }).join("\n");
                    window.prompt("Invite links (copy and share):", links);
                });
            }

            function bindRsvpToggles() {
                document.addEventListener("click", (event) => {
                    const target = event.target.closest("[data-toggle-rsvps]");
                    if (!target) return;
                    event.preventDefault();
                    const eventId = target.getAttribute("data-toggle-rsvps");
                    if (!eventId) return;
                    const panel = document.querySelector(`[data-rsvps-panel="${eventId}"]`);
                    if (!panel) return;
                    panel.style.display = panel.style.display === "none" ? "block" : "none";
                });
            }

            function bindStorageSync() {
                window.addEventListener("storage", (event) => {
                    if ([STORAGE_KEYS.events, STORAGE_KEYS.invites, STORAGE_KEYS.rsvps].includes(event.key)) {
                        renderEvents();
                    }
                });
            }

            function showCreatedBanner() {
                const banner = document.getElementById("fw-created-banner");
                if (!banner) return;
                const params = new URLSearchParams(window.location.search);
                const created = params.get("created") || sessionStorage.getItem("fw_event_created");
                if (created) {
                    banner.textContent = "Event created \u2705";
                    sessionStorage.removeItem("fw_event_created");
                    setTimeout(() => { banner.textContent = ""; }, 3000);
                }
            }

            function showInviteBanner(count) {
                const banner = document.getElementById("fw-invite-banner");
                if (!banner) return;
                banner.textContent = `Invites generated \u2705 (${count})`;
                setTimeout(() => { banner.textContent = ""; }, 3000);
            }

            ensureSeedData();
            renderEvents();
            showCreatedBanner();
            bindCopyLinks();
            bindInviteButtons();
            bindRsvpToggles();
            bindStorageSync();
        })();
    </script>
</body>

</html>




